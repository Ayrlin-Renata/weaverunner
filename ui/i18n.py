class I18N:
    def __init__(self, language='en'):
        self.languages = {
            'en': {
                'window_title': "WeaveRunner",
                'menu_language': "Language",
                'menu_view': "View",
                'menu_automation': "Automation",
                'menu_show_console': "Show Console",
                'watch_map_button': "Watch Map File...",
                'stop_watching_map_button': "Stop Watching '{filename}'",
                'watch_clip_button': "Watch .clip File...",
                'stop_watching_clip_button': "Stop Watching '{filename}'",
                'import_images_button': "Import Images...",
                'texture_slots_label': "Texture Management",
                'status_ready': "Ready. Apply will control keyboard/mouse. ESC to stop.",
                'status_error_anchor': "Creator window must be fully visible and on only one monitor.",
                'status_found_anchor': "App window found on {monitor_name}. Starting automation...",
                'status_warn_no_image': "Warning: Slot {slot_id} is Managed but has no image. Aborting.",
                'status_warn_no_group': "Warning: Slot {slot_id} is Managed but has no group name. Aborting.",
                'status_warn_not_512': "Warning: Image in slot {slot_id} is not 512x512. Aborting.",
                'status_warn_no_image_managed': "Warning: Slot {slot_id} is Managed but has no image. Apply is disabled.",
                'status_no_updates': "Fast Apply: No textures updated. Make sure you've saved/exported.",
                'status_running': "Automation running... Press ESC to stop.",
                'status_finished': "Automation finished.",
                'status_halted': "Automation halted.",
                'status_fast_apply_failed': "Fast Apply failed: state unknown. Please use Full Apply.",
                'status_stopped_watching': "Stopped watching Map file.",
                'status_watching': "Watching for changes to run tile-splitter...",
                'status_stopped_watching_clip': "Stopped watching .clip file.",
                'status_watching_clip': "Watching .clip file to extract layer '{layer_name}' and split...",
                'fast_apply_button': "Fast Apply",
                'full_apply_button': "Full Apply",
                'apply_button_running': "Running...",
                'console_title': "Console Log",
                'slot_mode': "Apply Mode:",
                'slot_group': "Template Part:",
                'slot_group_placeholder': "e.g., Waist",
                'slot_image_placeholder': "Add texture (512x512)",
                'slot_no_file': "No file selected.",
                'slot_size': "Size",
                'slot_angle': "Angle",
                'slot_x_pos': "X Position",
                'slot_y_pos': "Y Position",
                'slot_opacity': "Opacity",
                'slot_h_flip': "H-Flip",
                'slot_v_flip': "V-Flip",
                'slot_h_repeat': "H-Repeat",
                'slot_v_repeat': "V-Repeat",
                'slot_mode_managed': "Managed",
                'slot_mode_ignored': "Ignored",
                'slot_warn_not_512': "Image is not 512x512!",
                'slot_warn_load_fail': "Could not load image.",
                'dialog_ok': "OK",
                'dialog_cancel': "Cancel",
                'dialog_error': "Error",
                'save_preset_dialog_title': "Save Preset",
                'save_preset_name': "Preset Name:",
                'save_preset_desc': "Description:",
                'load_preset_dialog_title': "Load Preset",
                'load_preset_available': "Available Presets",
                'load_preset_none': "No presets saved yet.",
                'load_preset_no_desc': "No description.",
                'manage_presets_button': "Manage Presets",
                'preset_manager_title': "Preset Manager",
                'preset_manager_load': "Load",
                'preset_manager_save_current': "Save as New Preset...",
                'preset_manager_save_section_title': "Save Preset",
                'language_names_button': "Language Names...",
                'language_names_dialog_title': "Set Language-Specific Names",
                'language_names_en': "English Name:",
                'language_names_ja': "Japanese Name (日本語):",
                'preset_manager_save_new': "Save New",
                'preset_manager_import': "Import...",
                'preset_manager_export': "Export...",
                'preset_manager_delete': "Delete",
                'preset_manager_open_folder': "Presets Folder...",
                'preset_manager_close': "Close",
                'preset_manager_confirm_delete_title': "Confirm Deletion",
                'preset_manager_confirm_delete_msg': "Are you sure you want to delete the {count} selected preset(s)? This cannot be undone.",
                'preset_manager_import_success': "Successfully imported {count} preset(s).",
                'preset_manager_no_selection': "No presets selected.",
                'preset_manager_name_empty': "Preset name cannot be empty.",
                'preset_manager_other_languages': "Also in: {langs}",
                'agreement_dialog_title': "User Agreement",
                'agreement_dialog_text': "This application contains features that automate keyboard and mouse input. These features interact with other applications on your computer.\n\nBy clicking \"I Understand\" or by using this software, you acknowledge that you are using it at your own risk. The creator(s) of this application are not responsible for any actions performed by the software, whether intended or unintended, nor for any consequences that may arise from its use.",
                'agreement_dialog_button': "I Understand",
                'agreement_dialog_close_app': "Close Application",
                'menu_control_settings': "Control Settings...",
                'automation_settings_dialog_title': "Automation Control Settings",
                'reset_to_defaults_button': "Reset to Defaults",
                'copy_settings_button': "Copy Settings",
                'paste_settings_button': "Paste Settings",
                'settings_copied_msg': "Settings copied to clipboard.",
                'settings_pasted_msg': "Settings applied from clipboard.",
                'paste_error_msg': "Could not apply settings. Invalid format or clipboard content.\n\nError: {error}",
                'clip_watch_settings_dialog_title': "Clip Watch Scale Settings",
                'clip_watch_scale_factor_label': "Downscale Factor (e.g., 2):",
                'clip_watch_algorithm_label': "Downscale Algorithm:",
                'clip_watch_error_invalid_scale': "Scale factor must be a positive whole number (e.g., 1, 2, 3).",
            },
            'ja': {
                'window_title': "ウィーヴランナー",
                'menu_language': "言語 (Language)",
                'menu_view': "表示 (View)",
                'menu_automation': "自動化 (Automation)",
                'menu_show_console': "コンソール表示",
                'watch_map_button': "マップファイル監視...",
                'stop_watching_map_button': "'{filename}'の監視を停止",
                'watch_clip_button': ".clipファイル監視...",
                'stop_watching_clip_button': "'{filename}'の監視を停止",
                'import_images_button': "画像インポート...",
                'texture_slots_label': "テクスチャスロット",
                'status_ready': "準備完了。ファイルの監視は自動です。",
                'status_error_anchor': "エラー: 'app_anchor.png' が見つかりません。",
                'status_found_anchor': "成功！アプリウィンドウを {monitor_name} で発見。自動化を開始します...",
                'status_warn_no_image': "警告: スロット {slot_id} は管理対象ですが画像がありません。中止します。",
                'status_warn_no_group': "警告: スロット {slot_id} は管理対象ですがグループ名がありません。中止します。",
                'status_warn_not_512': "警告: スロット {slot_id} の画像が512x512ではありません。中止します。",
                'status_warn_no_image_managed': "警告: スロット {slot_id} は管理対象ですが画像がありません。適用は無効です。",
                'status_no_updates': "高速適用: 更新されたテクスチャはありません。何もすることはありません。",
                'status_running': "自動化実行中... ESCキーで停止。",
                'status_finished': "自動化が完了しました。",
                'status_halted': "自動化が停止しました。",
                'status_fast_apply_failed': "高速適用に失敗しました: 状態が不明です。完全適用を使用してください。",
                'status_stopped_watching': "マップファイルの監視を停止しました。",
                'status_watching': "タイル分割実行のため変更を監視中...",
                'status_stopped_watching_clip': ".clipファイルの監視を停止しました。",
                'status_watching_clip': ".clipファイルの変更を監視してレイヤー「{layer_name}」を抽出・分割中...",
                'fast_apply_button': "高速適用",
                'full_apply_button': "完全適用",
                'apply_button_running': "実行中...",
                'console_title': "コンソールログ",
                'slot_mode': "モード:",
                'slot_group': "グループ:",
                'slot_group_placeholder': "例: 腰",
                'slot_image_placeholder': "クリックしてテクスチャを追加 (512x512)",
                'slot_no_file': "ファイルが選択されていません。",
                'slot_size': "サイズ",
                'slot_angle': "角度",
                'slot_x_pos': "X座標",
                'slot_y_pos': "Y座標",
                'slot_opacity': "不透明度",
                'slot_h_flip': "左右反転",
                'slot_v_flip': "上下反転",
                'slot_h_repeat': "水平リピート",
                'slot_v_repeat': "垂直リピート",
                'slot_mode_managed': "管理対象",
                'slot_mode_ignored': "無視",
                'slot_warn_not_512': "画像が512x512ではありません！",
                'slot_warn_load_fail': "画像を読み込めませんでした。",
                'dialog_ok': "OK",
                'dialog_cancel': "キャンセル",
                'dialog_error': "エラー",
                'save_preset_dialog_title': "プリセットを保存",
                'save_preset_name': "プリセット名:",
                'save_preset_desc': "説明:",
                'load_preset_dialog_title': "プリセットを読み込む",
                'load_preset_available': "利用可能なプリセット",
                'load_preset_none': "まだプリセットが保存されていません。",
                'load_preset_no_desc': "説明がありません。",
                'manage_presets_button': "プリセット管理",
                'preset_manager_title': "プリセットマネージャー",
                'preset_manager_load': "読み込む",
                'preset_manager_save_current': "現在を新規保存...",
                'preset_manager_save_section_title': "プリセットを保存",
                'language_names_button': "言語別の名前...",
                'language_names_dialog_title': "言語別の名前を設定",
                'language_names_en': "英語名:",
                'language_names_ja': "日本語名:",
                'preset_manager_save_new': "新規保存",
                'preset_manager_import': "インポート...",
                'preset_manager_export': "選択をエクスポート...",
                'preset_manager_delete': "選択を削除",
                'preset_manager_open_folder': "プリセットフォルダ...",
                'preset_manager_close': "閉じる",
                'preset_manager_confirm_delete_title': "削除の確認",
                'preset_manager_confirm_delete_msg': "選択した{count}個のプリセットを本当に削除しますか？この操作は元に戻せません。",
                'preset_manager_import_success': "{count}個のプリセットを正常にインポートしました。",
                'preset_manager_no_selection': "プリセットが選択されていません。",
                'preset_manager_name_empty': "プリセット名は空にできません。",
                'preset_manager_other_languages': "他の言語: {langs}",
                'agreement_dialog_title': "利用規約",
                'agreement_dialog_text': "このアプリケーションには、キーボードとマウスの入力を自動化する機能が含まれています。これらの機能は、お使いのコンピュータ上の他のアプリケーションと連携します。\n\n「理解しました」をクリックするか、本ソフトウェアを使用することにより、お客様は自己の責任において本ソフトウェアを使用することを承認したものとみなされます。本アプリケーションの作成者は、意図的であるか否かにかかわらず、本ソフトウェアによって実行されるいかなる行為、またその使用から生じうるいかなる結果についても責任を負いません。",
                'agreement_dialog_button': "理解しました",
                'agreement_dialog_close_app': "アプリを終了",
                'menu_control_settings': "コントロール設定...",
                'automation_settings_dialog_title': "自動化コントロール設定",
                'reset_to_defaults_button': "デフォルトにリセット",
                'copy_settings_button': "設定をコピー",
                'paste_settings_button': "設定を貼り付け",
                'settings_copied_msg': "設定がクリップボードにコピーされました。",
                'settings_pasted_msg': "設定がクリップボードから貼り付けられました。",
                'paste_error_msg': "設定を貼り付けられませんでした。無効な形式またはクリップボードの内容です。\n\nエラー: {error}",
                'clip_watch_settings_dialog_title': "Clip監視 縮小設定",
                'clip_watch_scale_factor_label': "縮小率 (例: 2):",
                'clip_watch_algorithm_label': "縮小アルゴリズム:",
                'clip_watch_error_invalid_scale': "縮小率は正の整数である必要があります (例: 1, 2, 3)。",
            }
        }
        self.language = language
    
    def set_language(self, language):
        if language in self.languages:
            self.language = language
        else:
            print(f"Warning: Language '{language}' not found. Falling back to 'en'.")
            self.language = 'en'
    
    def t(self, key, **kwargs):
        return self.languages[self.language].get(key, key).format(**kwargs)
